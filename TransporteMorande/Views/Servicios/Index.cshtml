.@model TransporteMorande.Models.TurismoViewModel
@{
    Layout = "../Shared/_Layout.cshtml";

}
@section Styles
{
    @*<link href="../plugins/bower_components/footable/css/footable.core.css" rel="stylesheet">
        <link href="../plugins/bower_components/bootstrap-select/bootstrap-select.min.css" rel="stylesheet" />*@

    <link href="../plugins/bower_components/datatables/jquery.dataTables.min.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.datatables.net/buttons/1.2.2/css/buttons.dataTables.min.css" rel="stylesheet" type="text/css" />

    <link rel="stylesheet" href="../plugins/bower_components/dropify/dist/css/dropify.min.css">
    <link href="../plugins/bower_components/sweetalert/sweetalert.css" rel="stylesheet" type="text/css">
    <link href="../plugins/bower_components/custom-select/custom-select.css" rel="stylesheet" type="text/css" />
    <link href="../plugins/bower_components/bootstrap-select/bootstrap-select.min.css" rel="stylesheet" />



    <link href="../plugins/bower_components/bootstrap-datepicker/bootstrap-datepicker.min.css" rel="stylesheet" type="text/css" />
    <link href="../plugins/bower_components/custom-select/custom-select.css" rel="stylesheet" type="text/css" />
    <link href="../plugins/bower_components/switchery/dist/switchery.min.css" rel="stylesheet" />
    <link href="../plugins/bower_components/bootstrap-select/bootstrap-select.min.css" rel="stylesheet" />
    <link href="../plugins/bower_components/bootstrap-tagsinput/dist/bootstrap-tagsinput.css" rel="stylesheet" />
    <link href="../plugins/bower_components/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.css" rel="stylesheet" />
    <link href="../plugins/bower_components/multiselect/css/multi-select.css" rel="stylesheet" type="text/css" />

    <style>
        .imagenesPerso {
            max-width: 150px;
            max-height: 150px;
        }
    </style>
}
@*<div class="page-header">
        <h1>Mantenedor de Servicios de Turismo</h1>
        <a href="#" id='nuevoSlider' title='Nuevo' class='btn btn-success pull-right botonNuevo'>Nuevo Servicio</a>
    </div>
    <table class="table table-striped table-hover ">
        <thead>
            <tr>
                <th>Fotografía</th>
                <th>Título</th>
                <th>Contenido</th>
                <th>Precio</th>
                <th></th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (TransporteMorande.Models.Turismo_ a in Model.Publicaciones)
            {
                <tr>
                    <td><img src="@a.Imagen" width="150" height="70" /></td>
                    <td>@a.Titulo</td>
                    <td>@Html.Raw(a.ContenidoAux)</td>
                    <td>@a.Precio</td>
                    <td><a href="#" id="@a.Posicion" data-posicion="@a.Posicion" data-precio="@a.Precio" data-url="@a.Imagen" data-titulo="@a.Titulo" data-contenido="@a.Contenido" title='Modificar' class='btn btn-info trigger-modal-edit'><span class='glyphicon glyphicon-edit'></span></a></td>
                    <td><a href="#" id="@a.Posicion" title='Eliminar' class='btn btn-danger trigger-modal-delete'><span class='glyphicon glyphicon-remove-circle'></span></a></td>
                </tr>
            }
        </tbody>
    </table>*@

@*<div class="row bg-title">
        <div class="col-lg-3 col-md-4 col-sm-4 col-xs-12">
            <h4 class="page-title">Mantenedor</h4>
        </div>
    </div>*@
<div class="row bg-title">
    <div class="col-lg-3 col-md-4 col-sm-4 col-xs-12">
        <h4 class="page-title">Servicios</h4>
    </div>
    <div class="col-lg-9 col-sm-8 col-md-8 col-xs-12">
        <a href="javascript: void(0);" target="_blank" id="nuevoServicio" class="btn btn-danger pull-right m-l-20 hidden-xs hidden-sm waves-effect waves-light">NUEVO SERVICIO</a>
        <ol class="breadcrumb">
            <li><a href="#">Mantenedores</a></li>
            <li class="active">Servicios</li>
        </ol>
    </div>
    <!-- /.col-lg-12 -->
</div>

<div class="row">
    <div class="col-md-3">
        <div class="panel panel-default">
            <div class="panel-heading">
                Criterios de búsqueda
            </div>
            @using (Html.BeginForm("Index", "Servicios", FormMethod.Post, new { @class = "form-horizontal", @id = "form_enviar" }))
            {
                <div class="panel-wrapper collapse in">
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-md-12">
                                <h6>Nombre</h6>
                                @Html.EditorFor(x => x.NombreSeleccionado, new { htmlAttributes = new { @id = "NombreSeleccionado", @class = "form-control" } })
                            </div>
                        </div>
                    </div>
                    <div class="panel-footer"><button type="submit" id="filtrarServicios" class="btn btn-success" value="Filtrar">Filtrar</button> </div>
                </div>
            }
        </div>
    </div>
    <div class="col-md-9">
        <div class="white-box">
            @*<h3 class="box-title">Servicios de Turismo</h3>*@
            <div class="scrollable">
                <div class="table-responsive">
                    <table id="tablaTurismo" class="table m-t-30 table-responsive table-striped">
                        <thead>
                            <tr>
                                <th>Imagen</th>
                                <th>Título</th>
                                <th>¿En el sitio?</th>
                                <th>Precio</th>
                                <th>Acción</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var a in Model.Publicaciones)
                            {
                                <tr>
                                    <td width="60"><img src="@(string.IsNullOrEmpty(a.Imagen) ? "../plugins/images/perfilestandar.jpg" : a.Imagen)" class="img-circle" width="30" /></td>
                                    <td>@a.Titulo</td>
                                    <td>@(a.Web ? "Sí" : "No")</td>
                                    <td><span class="label label-info">@a.Precio.ToString("N0")</span> </td>

                                    <td>
                                        <button type="button" id="@a.Id" value="@a.Id" onclick="modificar(value);" class='btn btn-sm btn-icon btn-pure btn-outline jsgrid-edit-button trigger-modal-edit' data-toggle="tooltip" data-original-title="Modificar"><i class="ti-pencil" aria-hidden="true"></i></button>
                                        <button type="button" id="@a.Id" value="@a.Id" onclick="consultaEliminar(value);" data-toggle="tooltip" data-original-title="Eliminar" class='btn btn-sm btn-icon btn-pure btn-outline trigger-modal-delete'><i class="ti-close" aria-hidden="true"></i></button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="ModalNuevaPublicacion" tabindex="-1" role="dialog" aria-labelledby="">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <div class="white-box ui-front">
                    @using (Ajax.BeginForm("", "", new AjaxOptions
                    {
                        InsertionMode = InsertionMode.Replace,
                        UpdateTargetId = "idMensaje",
                        LoadingElementId = "loader2",
                        HttpMethod = "Post"
                    }, new { @class = "form-horizontal form-material", enctype = "multipart/form-data", @id = "form_enviarNuevo" }))
                    {
                        <h3 class="box-title m-b-0">Nuevo Servicio</h3>
                        <small>Transportes Morandé</small>

                        <div class="sttabs tabs-style-bar m-t-20">
                            <nav>
                                <ul>
                                    <li><a href="#section-bar-1" class="sticon ti-home"><span>Datos Básicos</span></a></li>
                                    <li><a href="#section-bar-2" class="sticon ti-instagram"><span>Sitio Web</span></a></li>
                                </ul>
                            </nav>
                            <div class="content-wrap ">
                                <section id="section-bar-1" style="padding:0px; padding-top:15px;">
                                    <div class="col-md-12">

                                        <input type="hidden" id="idSlider" name="Form.Id" />
                                        <div class="form-group ">

                                            <div class="col-xs-6">
                                                <label for="Titulo">Nombre</label>
                                                <input class="form-control" name="Nombre" id="Nombre" type="text" required="">
                                            </div>
                                            <div class="col-xs-6">
                                                <label for="Precio">Precio Estándar</label>
                                                <div class="input-group">
                                                    <div class="input-group-addon"><i class="ti-money"></i></div>
                                                    <input class="form-control" name="Precio" id="Precio" type="text">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="col-md-12">
                                                <label>Comisiones</label>
                                                <div class="input-group">
                                                    @Html.DropDownList("ComisionesNuevo", Model.Comisiones, new { @class = "form-control Comisiones", @id = "ComisionesNuevo" })
                                                    @*<div class="input-group-btn"><button type="button" value="Add" class="btn btn-success"></button></div>*@
                                                    <span class="input-group-btn">
                                                        <button class="btn btn-success Comisiones-Add" type="button"><i class="ti-plus"></i></button>
                                                        <button class="btn btn-danger Comisiones-Delete" type="button"><i class="ti-minus"></i></button>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="col-md-12">
                                                <label>Tickets</label>
                                                <div class="input-group">
                                                    @Html.DropDownList("TicketsNuevo", Model.Tickets, new { @class = "form-control Tickets", data_style = "btn-default btn-outline", @id = "TicketsNuevo" })
                                                    <span class="input-group-btn">
                                                        <button class="btn btn-success Tickets-Add" type="button"><i class="ti-plus"></i></button>
                                                        <button class="btn btn-danger Tickets-Delete" type="button"><i class="ti-minus"></i></button>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                </section>
                                <section id="section-bar-2" style="padding:0px; padding-top:15px;">
                                    <div class="col-md-7">
                                        <div class="form-group m-t-20">
                                            <div class="col-xs-12">
                                                <div class="checkbox checkbox-primary">
                                                    <input id="checkboxAndroid" type="checkbox" name="SitioWeb">
                                                    <label for="checkboxAndroid"> ¿Publicar en sitio web? </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group ">
                                            <div class="col-xs-12">
                                                <label for="Contenido">Contenido Web</label>
                                                <textarea class="form-control" name="Contenido" id="Contenido" type="text" rows="6" placeholder="Contenido Web"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-5 ">
                                        <div class="form-group  m-t-20">
                                            <div class="col-xs-12">
                                                <input id="fileNuevoServicio" type="file" class="dropify" name="Imagen" data-show-preview="false" data-show-upload="false" data-show-remove="false">
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                        <div class="form-group text-center m-t-20">
                            <div class="col-xs-12">
                                <button class="btn btn-info btn-lg btn-block text-uppercase waves-effect waves-light" type="submit">Crear servicio</button>
                            </div>
                        </div>

                        <div id="idMensaje">

                        </div>
                        <div id="loader2" class=" aletr" style="display:none">
                            <svg class="circular" viewBox="25 25 50 50">
                                <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10" />
                            </svg>
                        </div>

                    }
                </div>
            </div>

        </div>
    </div>
</div>


<div class="modal fade" id="ModalModificarPublicacion" tabindex="-1" role="dialog" aria-labelledby="">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <div class="white-box ui-front">
                    @using (Ajax.BeginForm("", "", new AjaxOptions
                    {
                        InsertionMode = InsertionMode.Replace,
                        UpdateTargetId = "idMensaje2",
                        LoadingElementId = "loader3",
                        HttpMethod = "Post"
                    }, new { @class = "form-horizontal form-material", enctype = "multipart/form-data", @id = "form_enviarModificar" }))
                    {
                        <h3 class="box-title m-b-0">Modificar Servicio</h3>
                        <small>Transportes Morandé</small>

                        <div class="sttabs tabs-style-bar m-t-20">
                            <nav>
                                <ul>
                                    <li><a href="#section-bar-1" class="sticon ti-home"><span>Datos Básicos</span></a></li>
                                    <li><a href="#section-bar-2" class="sticon ti-instagram"><span>Sitio Web</span></a></li>
                                </ul>
                            </nav>
                            <div class="content-wrap ">
                                <section id="section-bar-1" style="padding:0px; padding-top:15px;">
                                    <div class="col-md-12">

                                        <input type="hidden" id="idServicioModificar" />

                                        <div class="form-group ">
                                            <div class="col-xs-6">
                                                <label for="Titulo">Nombre</label>
                                                <input class="form-control" name="NombreModificar" id="NombreModificar" type="text" required="">
                                            </div>
                                            <div class="col-xs-6">
                                                <label for="Precio">Precio Estándar</label>
                                                <div class="input-group">
                                                    <div class="input-group-addon"><i class="ti-money"></i></div>
                                                    <input class="form-control" name="PrecioModificar" id="PrecioModificar" type="text">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="col-md-12">
                                                <label>Comisiones</label>
                                                <div class="input-group">
                                                    @Html.DropDownList("ComisionesModificar", Model.Comisiones, new { @class = "form-control Comisiones", @id = "ComisionesModificar" })
                                                    @*<div class="input-group-btn"><button type="button" value="Add" class="btn btn-success"></button></div>*@
                                                    <span class="input-group-btn">
                                                        <button class="btn btn-success Comisiones-Add" type="button"><i class="ti-plus"></i></button>
                                                        <button class="btn btn-danger Comisiones-Delete" type="button"><i class="ti-minus"></i></button>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="col-md-12">
                                                <label>Tickets</label>
                                                <div class="input-group">
                                                    @Html.DropDownList("TicketsModificar", Model.Tickets, new { @class = "form-control Tickets", data_style = "btn-default btn-outline", @id = "TicketsModificar" })
                                                    <span class="input-group-btn">
                                                        <button class="btn btn-success Tickets-Add" type="button"><i class="ti-plus"></i></button>
                                                        <button class="btn btn-danger Tickets-Delete" type="button"><i class="ti-minus"></i></button>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                </section>
                                <section id="section-bar-2" style="padding:0px; padding-top:15px;">
                                    <div class="col-md-7">
                                        <div class="form-group m-t-20">
                                            <div class="col-xs-12">
                                                <div class="checkbox checkbox-primary">
                                                    <input id="checkboxAndroidModificar" type="checkbox">
                                                    <label for="checkboxAndroidModificar"> ¿Publicar en sitio web? </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group ">
                                            <div class="col-xs-12">
                                                <label for="ContenidoModificar">Contenido Web</label>
                                                <textarea class="form-control" id="ContenidoModificar" type="text" rows="6" placeholder="Contenido Web"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-5 ">
                                        <div class="form-group  m-t-20">
                                            <div class="col-xs-12">
                                                <input id="fileNuevoServicioModificar" type="file" class="dropify" data-show-preview="false" data-show-upload="false" data-show-remove="false">
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                        <div class="form-group text-center m-t-20">
                            <div class="col-xs-12">
                                <button class="btn btn-info btn-lg btn-block text-uppercase waves-effect waves-light" type="submit">Modificar servicio</button>
                            </div>
                        </div>

                        <div id="idMensaje2">

                        </div>
                        <div id="loader3" class=" aletr" style="display:none">
                            <svg class="circular" viewBox="25 25 50 50">
                                <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10" />
                            </svg>
                        </div>

                    }
                </div>
            </div>

        </div>
    </div>
</div>

<div class="modal fade" id="modalNuevaComision" tabindex="-1" role="dialog" aria-labelledby="">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <div class="white-box">
                    <form class="form-horizontal form-material" id="formNuevaComision">
                        <h3 class="box-title m-b-0">Agregar comisión</h3>
                        <small>Transportes Morandé</small>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group m-t-20">
                                    <label class="col-xs-12">Precio Inicial</label>
                                    <div class="col-xs-12">
                                        <div class="input-group m-t-10">
                                            <span class="input-group-addon"><i class="fa fa-dollar"></i></span>
                                            <input type="number" id="PrecioInicialAgregarComision" name="PrecioInicial" class="form-control form-control-line p-l-5">
                                        </div>

                                    </div>
                                </div>
                                <div class="form-group ">
                                    <label class="col-xs-12">Precio Final</label>
                                    <div class="col-xs-12">
                                        <div class="input-group m-t-10">
                                            <span class="input-group-addon"><i class="fa fa-dollar"></i></span>
                                            <input type="number" id="PrecioFinalAgregarComision" name="PrecioFinal" class="form-control form-control-line p-l-5">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group ">
                                    <label class="col-xs-12">Porcentaje Comisión</label>
                                    <div class="col-xs-12">
                                        <div class="input-group m-t-10">
                                            <input type="number" id="PorcentajeAgregarComision" name="Porcentaje" class="form-control">
                                            <span class="input-group-addon">%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group text-center m-t-20">
                            <div class="col-xs-12">
                                <button class="btn btn-success btn-block text-uppercase waves-effect waves-light" id="botonGuardarNuevaComisionNueva" type="button">Guardar</button>
                            </div>
                        </div>

                        <div id="mensajeModPass">

                        </div>
                        <div id="loaderModPass" class=" aletr" style="display:none">
                            <svg class="circular" viewBox="25 25 50 50">
                                <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10" />
                            </svg>
                        </div>
                    </form>
                </div>
            </div>


        </div>
    </div>
</div>

<div class="modal fade" id="modalNuevoTicket" tabindex="-1" role="dialog" aria-labelledby="">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <div class="white-box">
                    <form class="form-horizontal form-material" id="formNuevoTicket">
                        <h3 class="box-title m-b-0">Agregar ticket</h3>
                        <small>Transportes Morandé</small>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group m-t-10">
                                    <label class="col-xs-12">Nombre:</label>
                                    <div class="col-xs-12">
                                        <input type="text" id="NombreTicketAgregarTicket" name="NombreTicketAgregarTicket" class="form-control form-control-line p-l-5">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-xs-12">Valor:</label>
                                    <div class="col-xs-12">
                                        <div class="input-group m-t-10">
                                            <span class="input-group-addon"><i class="fa fa-dollar"></i></span>
                                            <input type="number" id="ValorTicketAgregarTicket" name="ValorTicketAgregarTicket" class="form-control form-control-line p-l-5">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group text-center m-t-20">
                            <div class="col-xs-12">
                                <button class="btn btn-success btn-block text-uppercase waves-effect waves-light" id="botonGuardarNuevoTicketNueva" type="button">Guardar</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>


        </div>
    </div>
</div>
@section Scripts{
    <script src="../plugins/bower_components/bootstrap-select/bootstrap-select.min.js" type="text/javascript"></script>
    <script src="../plugins/bower_components/custom-select/custom-select.min.js" type="text/javascript"></script>
    <script src="../plugins/bower_components/datatables/jquery.dataTables.min.js"></script>
    <script src="../plugins/bower_components/dropify/dist/js/dropify.min.js"></script>
    <script src="../plugins/bower_components/sweetalert/sweetalert.min.js"></script>
    <script src="~/js/cbpFWTabs.js"></script>

    <script>

        $('#ModalNuevaPublicacion').on('hidden.bs.modal', function () {
            $.ajax({
                type: "POST",
                url: '/Servicios/ResetTemps',
                cache: false,
                dataType: "json",
                success: function (response) {
                },
                error: function (response) {
                    alert(response.d);
                }
            });
        });

        $('#ModalModificarPublicacion').on('hidden.bs.modal', function () {
            $.ajax({
                type: "POST",
                url: '/Servicios/ResetTemps',
                cache: false,
                dataType: "json",
                success: function (response) {
                },
                error: function (response) {
                    alert(response.d);
                }
            });
        });


        (function () {
            [].slice.call(document.querySelectorAll('.sttabs')).forEach(function (el) {
                new CBPFWTabs(el);
            });
        })();

        $('.Tickets-Add').click(function () {     
            
            $('#NombreTicketAgregarTicket').val("");
            $('#ValorTicketAgregarTicket').val("");
            $('#modalNuevoTicket').modal();
            $('#ValorTicketAgregarTicket').focus();
        });

        $('.Tickets-Delete').click(function () {

            var seleccionado = $('#TicketsModificar').val();
            $.ajax({
                type: "POST",
                url: '/Servicios/DeleteTicketTemp',
                data: { id: seleccionado },
                cache: false,
                dataType: "json",
                success: function (response) {
                    $('.Tickets').empty();
                    $.each(response.Retorno, function (index, item) {
                        $('.Tickets').append($('<option>', { value: item.Id, text: 'Valor: $' + number_format(item.Valor, 0) + '. Nombre: ' + item.Nombre }));
                    });
                },
                failure: function (response) {
                    alert(response.d);
                }
            });
        });

        $('#botonGuardarNuevoTicketNueva').click(function () {
        var model = {
            Valor: $('#ValorTicketAgregarTicket').val(),
            Nombre: $('#NombreTicketAgregarTicket').val()
            };
            $.ajax({
                type: "POST",
                url: '/Servicios/AddTicketTemp',
                data:  model,
                cache: false,
                dataType: "json",
                success: function (response) {
                    $('.Tickets').empty();
                    $.each(response.Retorno, function (index, item) {
                        $('.Tickets').append($('<option>', { value: item.Id, text: 'Valor: $' + number_format(item.Valor, 0) + '. Nombre: ' + item.Nombre }));
                    });
                    $("#modalNuevoTicket").modal("hide");
                },
                error: function (response) {
                    console.log(response);
                }
            });
        });

        $('.Comisiones-Add').click(function () {
            
            $('#PrecioInicialAgregarComision').val("");
            $('#PrecioFinalAgregarComision').val("");
            $('#PorcentajeAgregarComision').val("");
            $('#modalNuevaComision').modal();
            $('#PrecioInicialAgregarComision').focus();
        });

        $('.Comisiones-Delete').click(function () {
            var seleccionado = $('#ComisionesNuevo').val();
            var seleccionado2 = $('#ComisionesModificar').val();
            console.log(seleccionado);
            console.log(seleccionado2);
            $.ajax({
                type: "POST",
                url: '/Servicios/DeleteComisionTemp',
                data: { id: seleccionado2 },
                cache: false,
                dataType: "json",
                success: function (response) {
                    $('.Comisiones').empty();
                    $.each(response.Retorno, function (index, item) {
                        $('.Comisiones').append($('<option>', { value: item.Id, text: 'Desde: $' + number_format(item.PrecioInicial, 0) + ' - Hasta: $' + number_format(item.PrecioFinal, 0) + '. Comisión: ' + number_format(item.Porcentaje, 0) + '%' }));
                    });
                },
                failure: function (response) {
                    alert(response.d);
                }
            });       
        });

        $('#botonGuardarNuevaComisionNueva').click(function () {
            var model = {
                PrecioInicial: $('#PrecioInicialAgregarComision').val(),
                PrecioFinal: $('#PrecioFinalAgregarComision').val(),
                Porcentaje: $('#PorcentajeAgregarComision').val()
            };

            $.ajax({
                type: "POST",
                url: '/Servicios/AddComisionTemp',
                data: model,
                cache: false,
                dataType: "json",
                success: function (response) {
                    $('.Comisiones').empty();
                    $.each(response.Retorno, function (index, item) {
                        console.log(item);
                        $('.Comisiones').append($('<option>', { value: item.Id, text: 'Desde: $' + number_format(item.PrecioInicial, 0) + ' - Hasta: $' + number_format(item.PrecioFinal, 0) + '. Comisión: ' + number_format(item.Porcentaje, 0) + '%' }));
                    });
                    $("#modalNuevaComision").modal("hide");
                },
                error: function (response) {
                    console.log(response);
                }
            });
        });


        function modificar(id) {
            $.ajax({
                type: "POST",
                url: '/Servicios/Obtener',
                data: { id: id },
                cache: false,
                dataType: "html",
                success: function (response) {
                    var data = $.parseJSON(response);
                    console.log(data);
                    $('#idServicioModificar').val(id);
                    $('#NombreModificar').val(data.nombre);
                    $('#PrecioModificar').val(data.precioCliente);

                    $('.Comisiones').empty();
                    if (data.comisiones.length > 0) {                        
                        $.each(data.comisiones, function (index, item) {
                            $('.Comisiones').append($('<option>', { value: item.Id, text: 'Desde: $' + number_format(item.PrecioInicial, 0) + ' - Hasta: $' + number_format(item.PrecioFinal, 0) + '. Comisión: ' + number_format(item.Porcentaje, 0) + '%' }));
                        });
                    }
                    else
                        $('.Comisiones').append($('<option>', { value: "Seleccione", text: 'Debe agregar al menos una comisión' }));
                    $('.Tickets').empty();
                    if (data.tickets.length > 0) {                        
                        $.each(data.tickets, function (index, item) {
                            $('.Tickets').append($('<option>', { value: item.Id, text: 'Valor: $' + number_format(item.Valor, 0) + '. Nombre: ' + item.Nombre }));
                        });
                    }
                    else $('.Tickets').append($('<option>', { value: "Seleccione", text: 'No es obligatorio el ingreso de tickets' }));
                    
                    //$('#tagsInputControlModificar').tagsinput(data.comisiones);
                    //$('#tagsInputControlModificar').tagsinput('add', data.comisiones);

                    //if (data.comisiones.length > 1)
                    //    $('#tagsInputControlModificar').tagsinput('add', data.comisiones);
                    //else $('#tagsInputControlModificar').tagsinput('removeAll');
                    //$('#tagsInputControlModificar').tagsinput('refresh');
                    //$('#checkboxAndroidModificar').val(data.web);
                    $('#ContenidoModificar').val(data.contenido);


                    if (data.web) {
                        $("#checkboxAndroidModificar").prop('checked', true);
                    }
                    else {
                        $("#checkboxAndroidModificar").prop('checked', false);
                    }
                    var imagenUrl = "";
                    if (data.imagen != "")
                        imagenUrl = data.imagen;
                    else imagenUrl = "../plugins/images/perfilestandar.jpg";

                    try {
                        var drEvent = $('#fileNuevoServicioModificar').dropify(
                            {
                                defaultFile: imagenUrl,
                                messages: {
                                    default: 'Mensaje default',
                                    replace: 'Arrastre o haga click para reemplazar',
                                    remove: 'Eliminar',
                                    error: 'Ocurrió un error'
                                }
                            });
                        drEvent = drEvent.data('dropify');
                        drEvent.resetPreview();
                        drEvent.clearElement();
                        drEvent.settings.defaultFile = imagenUrl;
                        drEvent.destroy();
                        drEvent.init();
                    }
                    catch (err) {
                        console.log(err);
                    }

                    $('#ModalModificarPublicacion').modal();
                },
                error: function (response) {
                    console.log(response);
                    //alert(response.d);
                }
            });
        }

        $('#nuevoServicio').click(function () {
            $('.Tickets').empty();
            $('.Tickets').append($('<option>', { value: "Seleccione", text: 'No es obligatorio el ingreso de tickets' }));
            $('.Comisiones').empty();
            $('.Comisiones').append($('<option>', { value: "Seleccione", text: 'Debe agregar al menos una comisión' }));
            $('#ModalNuevaPublicacion').modal();
        });

        function cerrarAlerta() {
            $('#filtrarServicios').click();
            $("#ModalNuevaPublicacion").modal("hide");
        }

        $('#form_enviarNuevo').on('submit', function (e) {
            var valor = $('#checkboxAndroid').is(':checked');
            if ($("#checkboxAndroid:checked")) {
                $("#checkboxAndroid:checked").val(true);
            } else {
                $("#checkboxAndroid:checked").val(false);
            }
            var formdata = new FormData();
            var getfile = document.getElementById('fileNuevoServicio');
            for (i = 0; i < getfile.files.length; i++) {
                formdata.append(getfile.files[i].name, getfile.files[i]);
            }
            var model = {
                Nombre: $("#Nombre").val(),
                Precio: $("#Precio").val(),
                SitioWeb: $("#checkboxAndroid").val(),
                Contenido: $("#Contenido").val()
            };
            $.ajax(
                {
                    url: '/Servicios/Nuevo/',
                    type: "Post",
                    async: false,
                    dataType: "json",
                    data: model,
                    success: function (resultado) {
                        console.log(resultado);
                        if (resultado.Error) {
                            $("#idMensaje").html("<div class=\"alert alert-danger alert-dismissable\"><button type=\"button\" class=\"close\" data-dismiss=\"alert\">×</button>" + resultado.Retorno + "</div>");
                        }
                        else {
                            formdata.append("id", resultado.Retorno);
                            formdata.append("tipo", "Creacion");
                            $.ajax({
                                url: '/Servicios/SubirImagen',
                                data: formdata,
                                contentType: false,
                                processData: false,
                                async: false,
                                type: 'POST',
                                success: function (data) {
                                    $("#idMensaje").html(data);
                                },
                                error: function (result) {
                                    console.log(result);
                                }
                            });
                        }

                    },
                    error: function (result) {
                        console.log(result);
                    }
                });
            return true;
        });

        $('#form_enviarModificar').on('submit', function (e) {
            var valor = $('#checkboxAndroidModificar').is(':checked');
            if ($("#checkboxAndroidModificar:checked")) {
                $("#checkboxAndroidModificar:checked").val(true);
            } else {
                $("#checkboxAndroidModificar:checked").val(false);
            }
            var formdata = new FormData();
            var getfile = document.getElementById('fileNuevoServicioModificar');
            for (i = 0; i < getfile.files.length; i++) {
                formdata.append(getfile.files[i].name, getfile.files[i]);
            }
            var model = {
                Id: $("#idServicioModificar").val(),
                Nombre: $("#NombreModificar").val(),
                Precio: $("#PrecioModificar").val(),
                ValorTicket: $("#ValorTicketModificar").val(),
                Comisiones: $("#tagsInputControlModificar").val(),
                SitioWeb: $("#checkboxAndroidModificar").val(),
                Contenido: $("#ContenidoModificar").val()
            };
            $.ajax(
                {
                    url: '/Servicios/Modificar/',
                    type: "Post",
                    async: false,
                    dataType: "json",
                    data: model,
                    success: function (resultado) {
                        console.log(resultado);
                        if (resultado.Error) {
                            $("#idMensaje2").html("<div class=\"alert alert-danger alert-dismissable\"><button type=\"button\" class=\"close\" data-dismiss=\"alert\">×</button>" + resultado.Retorno + "</div>");
                        }
                        else {
                            formdata.append("id", resultado.Retorno);
                            formdata.append("tipo", "Modificacion");
                            $.ajax({
                                url: '/Servicios/SubirImagen',
                                data: formdata,
                                contentType: false,
                                processData: false,
                                async: false,
                                type: 'POST',
                                success: function (data) {
                                    $("#idMensaje2").html(data);
                                },
                                error: function (result) {
                                    console.log(result);
                                }
                            });
                        }

                    },
                    error: function (result) {
                        console.log(result);
                    }
                });
            return true;
        });


        $(document).ready(function () {


        $('.dropify').dropify(
        {
            messages: {
                default: 'Mensaje default',
                replace: 'Arrastre o haga click para reemplazar',
                remove: 'Eliminar',
                error: 'Ocurrió un error'
            }
        });
        $('#tablaTurismo').DataTable(
        {
            "language": {
                "lengthMenu": "Mostrar _MENU_ registros por página",
                "zeroRecords": "Búsqueda sin resultados",
                "info": "Página _PAGE_ de _PAGES_",
                "infoEmpty": "No hay registros",
                "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                "search": "Buscar:",
                "first": "Primera página",
                "paginate": {
                    "previous": "Anterior",
                    "next": "Siguiente"
                }
            },
            "paging": true,
            "info": false,
            "ordering": false,
            "pageLength": 5,
            "lengthMenu": [5, 10, 25],
            "columns": [
                null,
                null,
                null,
                null,
                {
                    "width": 100
                }
            ]
        });
    });

         function consultaEliminar(id) {
            swal({
                title: "¿Estás seguro?",
                text: "El servicio ya no estará disponible.",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Eliminar",
                cancelButtonText: "Cancelar",
                closeOnConfirm: false,
                closeOnCancel: false,
                allowOutsideClick: false,
                showLoaderOnConfirm: true,
                preConfirm: function () {
                    return new Promise(function (resolve, reject) {
                        $.ajax({
                            success: function (response) {
                                resolve(response)
                            },
                            error: function (a, b, c) {
                                reject("error message")
                            }
                        })
                    })
                }
            }, function (isConfirm) {
                if (isConfirm) {
                    $.ajax({
                            type: "POST",
                            url: '@Url.Action("Eliminar", "Servicios")',
                            data: { id: id },
                            cache: false,
                            dataType: "json",
                            success: function (response) {
                                console.log(response);
                                if (response == "Exito") {
                                    swal("Servicio eliminado", "", "success");
                                    setTimeout(function () {
                                        $('#filtrarServicios').click();
                                    }, 2500);

                                }
                                else {
                                    swal("Ocurrió un error", "Contáctese con el administrador", "error");
                                }
                            }
                        });
                    }
                    else {
                        swal("Operación cancelada", "", "error");
                    }
                });
        }
    </script>

}
